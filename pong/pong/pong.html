<html>
	<head>

		<style>
			body {
				overflow:hidden;
				display: flex;
				align-items: center;
				justify-content: center;
			}
			
			#paddle {
				width: 40px;
				height: 150px;
				position: absolute;
				top: calc(50% - 75px);
				left: 50px;
				background-color: #666666;
			}
			#ball {
				position: absolute;
				top: calc(50%);
				left: calc(50%);
				background-color: #AA0000;	
			}
			#juego{
				background-color: black;
				height: 500px;
				width: 1500px;
				border: #494949 dashed 15px;
				position: relative;
				margin-top: 100px;
				overflow: hidden;
			} 
			#puntuacion {
				position: absolute;
				top: 0px;
				width: 100%;
				text-align: center;
				color: white;
				display: flex;
				justify-content: center;
				gap: 100px;
				
			}
			#puntuacion h3 {
					width: 200px;
					font-size: 50px;
					margin: 0;
					line-height: 1;        
					text-align: center;
				}
		</style>
	</head>
	<body>
		<div id="juego">
			<div id="paddle"><!-- paddle --></div>
			<div id="puntuacion">
				<h3 id="nombre"></h3>
				<h3 id="puntuacio">0</h3>	
			</div>
			<div id="ball"><!-- ball --></div>
		</div><br>
		<button id="finaliza">Salir del juego</button><!--onclick='window.location="index.html"'-->
		
	</body>	
		<script>
			const paddle = document.getElementById("paddle");
			const ball = document.getElementById("ball");
			const jogo = document.getElementById("juego");
			let boton = document.getElementById("finaliza");
			let puntu = document.getElementById("puntuacio"); 
			//Me permite pillar los elementos por queryStrings;
			let parametros = new URLSearchParams(window.location.search);
			let name = parametros.get("nombre");
			let nombre = document.getElementById("nombre");
			let control = parametros.get("control");
			let cont = 0;
			let speed = parametros.get("velocidad");
			let velocity;
			if(speed=="lenta"){
				velocity=5;
			}else if(speed=="normal"){
				velocity=15;
			}else{
				velocity=23;
			}
			nombre.textContent=name;
			boton.onclick = function(){
				let confirmar = confirm("Seguro que deseas acabar:");
				if(confirmar){
					window.location.href = "index.html";
				}else{
					
				}
			};
			let sube;
			let baja;
			let subir;
			let bajar;
			let raton; 
			let teclaActual; 
			if(control=="teclado"){
				sube = window.prompt("Que tecla quieres usar para subir").toLowerCase();
				baja = window.prompt("Que tecla quieres usar para bajar").toLowerCase();
			//Add onkeypress handler
			let pulsar = document.addEventListener("keydown",(event)=>{ 
				teclaActual = event;
				intervalo=setInterval(()=>move_paddle(teclaActual),5)});
			let parar = document.addEventListener("keyup",()=>{clearInterval(intervalo)});
			}else{
				//movimiento raton
				raton=document.addEventListener("mousemove", (event) => move_paddle_raton(event));
			}			
			const ball_radius = window.prompt("Introduce el radio de la bola");
			ball.style.width = 2*ball_radius + "px";
			ball.style.height = 2*ball_radius + "px";
			ball.style.borderRadius = ball_radius + "px";
			
			var velocity_x = velocity;
			var velocity_y = -velocity; 

			// Move ball
			var ball_movement = setInterval(move_ball, 25);

			function move_ball(){

				//Check Top 
				if (ball.offsetTop  <= 0) {
					velocity_y = -velocity_y;
				}

				//Check right
				if (ball.offsetLeft >= (jogo.clientWidth - 2*ball_radius)) {
					velocity_x = -velocity_x;
					cont+=1;
					puntu.textContent=cont;
				}

				//Check bottom
				if (ball.offsetTop >= (jogo.clientHeight -2*ball_radius)) {
					velocity_y = -velocity_y;
				}

				if (ball.offsetLeft <= 90 && 
					(ball.offsetTop >= (paddle.offsetTop-ball_radius))	&& 
					(ball.offsetTop <= (paddle.offsetTop + 150 - ball_radius))){
					velocity_x = -velocity_x;
				}

				//Check left
				if (ball.offsetLeft <= 10) {
					velocity_x = -velocity_x;
				}
				
				ball.style.top = (ball.offsetTop + velocity_y) +"px";
				ball.style.left = (ball.offsetLeft + velocity_x) +"px";
			
			}
			//funciones movimiento
			function move_paddle(pkey){ 
				const paddleTop = paddle.offsetTop;
				const paddleHeight = paddle.offsetHeight;
				const containerHeight = paddle.parentElement.offsetHeight;
				console.log("tecla pulsada: " + pkey.which);  
				console.log(sube +"y"+ baja);
				if (pkey.key == sube ){
					if (paddleTop > 0) {
						paddle.style.top = Math.max(paddleTop - 10, 0) + "px";
					}
					// paddle.style.top = (paddle.offsetTop - 10) +"px";
				} else if (pkey.key == baja){
					// paddle.style.top = (paddle.offsetTop + 10) +"px"; 
					if (paddleTop + paddleHeight < containerHeight) {
            			paddle.style.top = Math.min(paddleTop + 10, containerHeight - paddleHeight) + "px";
        			}
				}
			}
			function move_paddle_raton(mov){
			let paddleCenter = paddle.offsetTop + paddle.offsetHeight / 2;
			if (mov.clientY < paddleCenter) {
				paddle.style.top = (paddle.offsetTop - 10) + "px";
			}else if (mov.clientY > paddleCenter) {	
				paddle.style.top = (paddle.offsetTop + 10) + "px";
				}
			}
		</script>
</html>